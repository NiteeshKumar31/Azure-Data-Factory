{
	"name": "Flatten_Nested_Json",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "Json1",
						"type": "DatasetReference"
					},
					"name": "source1",
					"description": "{\"orders\": [{\"order_date\": \"2022-06-19\", \"order_id\": \"ORD2022061900000\", \"invoice_num\": \"INV2022061900000\", \"cust_id\": \"C005\", \"store_id\": \"S005\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P001\", \"qty\": 9, \"tax\": 16, \"tax_type\": \"PER\", \"discount\": 2, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P001\", \"qty\": 2, \"tax\": 8, \"tax_type\": \"INR\", \"discount\": 6, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P013\", \"qty\": 2, \"tax\": 17, \"tax_type\": \"INR\", \"discount\": 3, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P001\", \"qty\": 5, \"tax\": 13, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P010\", \"qty\": 2, \"tax\": 0, \"tax_type\": \"PER\", \"discount\": 6, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P008\", \"qty\": 3, \"tax\": 14, \"tax_type\": \"PER\", \"discount\": 8, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-08-14\", \"order_id\": \"ORD2022081410000\", \"invoice_num\": \"INV2022081410000\", \"cust_id\": \"C014\", \"store_id\": \"S002\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P007\", \"qty\": 6, \"tax\": 14, \"tax_type\": \"PER\", \"discount\": 6, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-05-17\", \"order_id\": \"ORD2022051720000\", \"invoice_num\": \"INV2022051720000\", \"cust_id\": \"C014\", \"store_id\": \"S003\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P014\", \"qty\": 6, \"tax\": 2, \"tax_type\": \"INR\", \"discount\": 7, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P002\", \"qty\": 8, \"tax\": 4, \"tax_type\": \"INR\", \"discount\": 0, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P001\", \"qty\": 8, \"tax\": 0, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-07-26\", \"order_id\": \"ORD2022072630000\", \"invoice_num\": \"INV2022072630000\", \"cust_id\": \"C015\", \"store_id\": \"S006\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P002\", \"qty\": 5, \"tax\": 13, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P003\", \"qty\": 1, \"tax\": 0, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-08-02\", \"order_id\": \"ORD2022080240000\", \"invoice_num\": \"INV2022080240000\", \"cust_id\": \"C006\", \"store_id\": \"S007\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P005\", \"qty\": 8, \"tax\": 14, \"tax_type\": \"INR\", \"discount\": 8, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P014\", \"qty\": 1, \"tax\": 13, \"tax_type\": \"PER\", \"discount\": 7, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P012\", \"qty\": 2, \"tax\": 1, \"tax_type\": \"INR\", \"discount\": 8, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-12-29\", \"order_id\": \"ORD2022122950000\", \"invoice_num\": \"INV2022122950000\", \"cust_id\": \"C010\", \"store_id\": \"S007\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P004\", \"qty\": 3, \"tax\": 4, \"tax_type\": \"PER\", \"discount\": 7, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-03-03\", \"order_id\": \"ORD2022030360000\", \"invoice_num\": \"INV2022030360000\", \"cust_id\": \"C004\", \"store_id\": \"S003\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P003\", \"qty\": 1, \"tax\": 3, \"tax_type\": \"PER\", \"discount\": 3, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-11-17\", \"order_id\": \"ORD2022111770000\", \"invoice_num\": \"INV2022111770000\", \"cust_id\": \"C009\", \"store_id\": \"S004\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P003\", \"qty\": 4, \"tax\": 7, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-03-11\", \"order_id\": \"ORD2022031180000\", \"invoice_num\": \"INV2022031180000\", \"cust_id\": \"C004\", \"store_id\": \"S006\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P005\", \"qty\": 5, \"tax\": 14, \"tax_type\": \"INR\", \"discount\": 7, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P005\", \"qty\": 4, \"tax\": 4, \"tax_type\": \"PER\", \"discount\": 0, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P009\", \"qty\": 4, \"tax\": 3, \"tax_type\": \"INR\", \"discount\": 1, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 9, \"tax\": 11, \"tax_type\": \"PER\", \"discount\": 8, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P012\", \"qty\": 1, \"tax\": 9, \"tax_type\": \"INR\", \"discount\": 2, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P009\", \"qty\": 6, \"tax\": 5, \"tax_type\": \"INR\", \"discount\": 4, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-09-04\", \"order_id\": \"ORD2022090490000\", \"invoice_num\": \"INV2022090490000\", \"cust_id\": \"C002\", \"store_id\": \"S004\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P011\", \"qty\": 5, \"tax\": 6, \"tax_type\": \"INR\", \"discount\": 0, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 7, \"tax\": 7, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-06-10\", \"order_id\": \"ORD2022061010000\", \"invoice_num\": \"INV2022061010000\", \"cust_id\": \"C013\", \"store_id\": \"S002\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P009\", \"qty\": 6, \"tax\": 2, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-10-24\", \"order_id\": \"ORD2022102411000\", \"invoice_num\": \"INV2022102411000\", \"cust_id\": \"C002\", \"store_id\": \"S001\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P014\", \"qty\": 4, \"tax\": 4, \"tax_type\": \"INR\", \"discount\": 8, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-02-03\", \"order_id\": \"ORD2022020312000\", \"invoice_num\": \"INV2022020312000\", \"cust_id\": \"C008\", \"store_id\": \"S005\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P004\", \"qty\": 7, \"tax\": 12, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 7, \"tax\": 6, \"tax_type\": \"PER\", \"discount\": 6, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P003\", \"qty\": 1, \"tax\": 4, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P007\", \"qty\": 1, \"tax\": 17, \"tax_type\": \"INR\", \"discount\": 5, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-09-11\", \"order_id\": \"ORD2022091113000\", \"invoice_num\": \"INV2022091113000\", \"cust_id\": \"C004\", \"store_id\": \"S006\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P002\", \"qty\": 7, \"tax\": 11, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P004\", \"qty\": 6, \"tax\": 15, \"tax_type\": \"INR\", \"discount\": 2, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 8, \"tax\": 3, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P002\", \"qty\": 6, \"tax\": 7, \"tax_type\": \"INR\", \"discount\": 3, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-12-03\", \"order_id\": \"ORD2022120314000\", \"invoice_num\": \"INV2022120314000\", \"cust_id\": \"C011\", \"store_id\": \"S004\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P014\", \"qty\": 1, \"tax\": 13, \"tax_type\": \"INR\", \"discount\": 3, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P005\", \"qty\": 9, \"tax\": 11, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 8, \"tax\": 8, \"tax_type\": \"PER\", \"discount\": 8, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-12-03\", \"order_id\": \"ORD2022120315000\", \"invoice_num\": \"INV2022120315000\", \"cust_id\": \"C002\", \"store_id\": \"S007\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P008\", \"qty\": 1, \"tax\": 6, \"tax_type\": \"PER\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-09-13\", \"order_id\": \"ORD2022091316000\", \"invoice_num\": \"INV2022091316000\", \"cust_id\": \"C014\", \"store_id\": \"S005\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P001\", \"qty\": 2, \"tax\": 5, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P007\", \"qty\": 1, \"tax\": 10, \"tax_type\": \"PER\", \"discount\": 2, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P005\", \"qty\": 9, \"tax\": 16, \"tax_type\": \"PER\", \"discount\": 4, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-05-12\", \"order_id\": \"ORD2022051217000\", \"invoice_num\": \"INV2022051217000\", \"cust_id\": \"C003\", \"store_id\": \"S002\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P010\", \"qty\": 1, \"tax\": 15, \"tax_type\": \"PER\", \"discount\": 7, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P011\", \"qty\": 3, \"tax\": 4, \"tax_type\": \"INR\", \"discount\": 7, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P006\", \"qty\": 1, \"tax\": 10, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P012\", \"qty\": 9, \"tax\": 2, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P012\", \"qty\": 8, \"tax\": 14, \"tax_type\": \"INR\", \"discount\": 9, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-01-12\", \"order_id\": \"ORD2022011218000\", \"invoice_num\": \"INV2022011218000\", \"cust_id\": \"C006\", \"store_id\": \"S005\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P011\", \"qty\": 7, \"tax\": 15, \"tax_type\": \"INR\", \"discount\": 8, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P003\", \"qty\": 2, \"tax\": 10, \"tax_type\": \"PER\", \"discount\": 8, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P013\", \"qty\": 9, \"tax\": 7, \"tax_type\": \"PER\", \"discount\": 0, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P013\", \"qty\": 2, \"tax\": 13, \"tax_type\": \"PER\", \"discount\": 0, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}]}, {\"order_date\": \"2022-06-13\", \"order_id\": \"ORD2022061319000\", \"invoice_num\": \"INV2022061319000\", \"cust_id\": \"C006\", \"store_id\": \"S003\", \"system_date\": \"2023-02-08 15:38:52.843869\", \"order_lines\": [{\"prod_id\": \"P009\", \"qty\": 3, \"tax\": 3, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P003\", \"qty\": 6, \"tax\": 16, \"tax_type\": \"INR\", \"discount\": 0, \"discount_type\": \"PER\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P002\", \"qty\": 3, \"tax\": 11, \"tax_type\": \"PER\", \"discount\": 5, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}, {\"prod_id\": \"P013\", \"qty\": 6, \"tax\": 12, \"tax_type\": \"PER\", \"discount\": 3, \"discount_type\": \"INR\", \"currency_code\": \"INR\"}]}]}"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ADLS_test_sink",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "flatten1"
				},
				{
					"name": "flatten2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          orders as (order_date as string, order_id as string, invoice_num as string, cust_id as string, store_id as string, system_date as string, order_lines as (prod_id as string, qty as integer, tax as integer, tax_type as string, discount as integer, discount_type as string, currency_code as string)[])[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'arrayOfDocuments') ~> source1",
				"source1 foldDown(unroll(orders, orders),",
				"     mapColumn(",
				"          order_date = orders.order_date,",
				"          order_id = orders.order_id,",
				"          invoice_num = orders.invoice_num,",
				"          cust_id = orders.cust_id,",
				"          store_id = orders.store_id,",
				"          system_date = orders.system_date,",
				"          order_lines = orders.order_lines",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten1",
				"flatten1 foldDown(unroll(order_lines, order_lines),",
				"     mapColumn(",
				"          order_date,",
				"          order_id,",
				"          invoice_num,",
				"          cust_id,",
				"          store_id,",
				"          system_date,",
				"          prod_id = order_lines.prod_id,",
				"          qty = order_lines.qty,",
				"          tax = order_lines.tax,",
				"          tax_type = order_lines.tax_type,",
				"          discount = order_lines.discount,",
				"          discount_type = order_lines.discount_type,",
				"          currency_code = order_lines.currency_code",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flatten2",
				"flatten2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     partitionFileNames:['flatten_nested_json'],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}